<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.5.56">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="author" content="Nicholas Varabioff">
<meta name="dcterms.date" content="2025-01-18">

<title>Fundamentals of Modern Hockey Analytics – Nicholas Varabioff’s Blog</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for citations */
div.csl-bib-body { }
div.csl-entry {
  clear: both;
  margin-bottom: 0em;
}
.hanging-indent div.csl-entry {
  margin-left:2em;
  text-indent:-2em;
}
div.csl-left-margin {
  min-width:2em;
  float:left;
}
div.csl-right-inline {
  margin-left:2em;
  padding-left:1em;
}
div.csl-indent {
  margin-left: 2em;
}</style>


<script src="../../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../../site_libs/quarto-nav/headroom.min.js"></script>
<script src="../../site_libs/clipboard/clipboard.min.js"></script>
<script src="../../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../../site_libs/quarto-search/fuse.min.js"></script>
<script src="../../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../../">
<script src="../../site_libs/quarto-html/quarto.js"></script>
<script src="../../site_libs/quarto-html/popper.min.js"></script>
<script src="../../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../../site_libs/quarto-html/anchor.min.js"></script>
<link href="../../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../../site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="../../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../../site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>


<link rel="stylesheet" href="../../styles.css">
</head>

<body class="nav-fixed fullcontent">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top quarto-banner">
    <nav class="navbar navbar-expand-lg " data-bs-theme="dark">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container mx-auto">
    <a class="navbar-brand" href="../../index.html">
    <span class="navbar-title">Nicholas Varabioff’s Blog</span>
    </a>
  </div>
            <div id="quarto-search" class="" title="Search"></div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" role="menu" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll ms-auto">
  <li class="nav-item">
    <a class="nav-link" href="../../about.html"> 
<span class="menu-text">About</span></a>
  </li>  
  <li class="nav-item compact">
    <a class="nav-link" href="https://github.com/nvarabioff"> <i class="bi bi-github" role="img">
</i> 
<span class="menu-text"></span></a>
  </li>  
  <li class="nav-item compact">
    <a class="nav-link" href="https://x.com/nickvarabioff"> <i class="bi bi-twitter" role="img">
</i> 
<span class="menu-text"></span></a>
  </li>  
</ul>
          </div> <!-- /navcollapse -->
            <div class="quarto-navbar-tools">
</div>
      </div> <!-- /container-fluid -->
    </nav>
</header>
<!-- content -->
<header id="title-block-header" class="quarto-title-block default page-columns page-full">
  <div class="quarto-title-banner page-columns page-full">
    <div class="quarto-title column-body">
      <h1 class="title">Fundamentals of Modern Hockey Analytics</h1>
                                <div class="quarto-categories">
                <div class="quarto-category">news</div>
                <div class="quarto-category">code</div>
                <div class="quarto-category">analysis</div>
              </div>
                  </div>
  </div>
    
  
  <div class="quarto-title-meta">

      <div>
      <div class="quarto-title-meta-heading">Author</div>
      <div class="quarto-title-meta-contents">
               <p>Nicholas Varabioff </p>
            </div>
    </div>
      
      <div>
      <div class="quarto-title-meta-heading">Published</div>
      <div class="quarto-title-meta-contents">
        <p class="date">January 18, 2025</p>
      </div>
    </div>
    
      
    </div>
    
  
  </header><div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
<!-- margin-sidebar -->
    
<!-- main -->
<main class="content quarto-banner-title-block" id="quarto-document-content">





<p><img src="image.png" class="img-fluid"></p>
<section id="introduction" class="level1">
<h1>Introduction</h1>
<p>Hockey, a sport consisting of two teams of five skaters and a goalie on ice, is a dynamic blend of tactics and physical skill. In today’s era of advanced analytics, the way teams, athletes, and fans understand hockey is changing rapidly. Predicting player performance, optimizing team strategies, and improving fan experience are prioritized by many smart minds in the sport. Using statistics, advanced analytics, and machine learning, we can uncover hidden patterns in the action and drive the evolution of hockey into a new generation.</p>
</section>
<section id="advanced-analytics" class="level1">
<h1>Advanced Analytics</h1>
<p>Beyond fundamental hockey metrics like goals and assists, “advanced” analytics are growing in popularity. It is important to understand these key metrics.</p>
<section id="corsi-and-fenwick" class="level2">
<h2 class="anchored" data-anchor-id="corsi-and-fenwick">Corsi and Fenwick</h2>
<p><strong>Corsi</strong> can be explained as shot attempts. This includes the sum of shots on goal, missed shots, and blocked shots. It can be measured for a team or a player. Most commonly, Corsi is used to approximate shot attempt differential, which can be used as an indication of future goal differentials. If a team or player has high Corsi, they are creating more chances than their opponents, which should result in a higher goal differential over time. Most players have a “Corsi For” percentage (percent of shots for their team, compared to their opponent) between 40 and 60. A player or team ranked above 55% is often considered elite <span class="citation" data-cites="wilson2014corsi"><a href="#ref-wilson2014corsi" role="doc-biblioref">[1]</a></span>.</p>
<p><strong>Fenwick</strong>, also known as “unblocked shot attempts”, is a variant of Corsi that only counts shots on goal and missed shots; it does not include blocked shots. It is generally viewed as having a stronger correlation to scoring chances. By itself, it is less reliable than Corsi, but it is the foundation of most Expected Goals models, which will be explained later <span class="citation" data-cites="wilson2014corsi"><a href="#ref-wilson2014corsi" role="doc-biblioref">[1]</a></span>.</p>
</section>
<section id="pdo" class="level2">
<h2 class="anchored" data-anchor-id="pdo">PDO</h2>
<p>Simply, <strong>PDO</strong> is the sum of a team’s shooting percentage (offensifve goals scored divided by total shots for) and save percentage (shots saved divided by total shots against), multiplied by 10. Most teams should expect a PDO of around 100. PDO is often viewed as a measure of how “lucky” a team is <span class="citation" data-cites="liu2023pdo"><a href="#ref-liu2023pdo" role="doc-biblioref">[2]</a></span>. For example, if a team has more goals scored on fewer shots, this could be interpreted as the team getting lucky with these goals; their shooting percentage would increase, resulting in a PDO greater than 100, reflecting this luck.</p>
</section>
<section id="expected-goals" class="level2">
<h2 class="anchored" data-anchor-id="expected-goals">Expected Goals</h2>
<p><strong>Expected goals</strong>, abbreviated as <strong>xG</strong>, is an attempt to give each shot attempt value, depending on its location and type <span class="citation" data-cites="oconnor2019playdriving"><a href="#ref-oconnor2019playdriving" role="doc-biblioref">[3]</a></span>. For example, a shot from the front of the net might get a score of 0.3, whereas a shot from the blueline might only get a score of 0.02. Generally, models will also factor in the situation of the game, such as if the shot is off a rebound or a rush <span class="citation" data-cites="hockeystatistics2022xgmodel"><a href="#ref-hockeystatistics2022xgmodel" role="doc-biblioref">[4]</a></span>. Essentially, xG can be viewed as a form of Corsi that values each shot differently. This is not an exact science, and there are many different xG models, such as the model from Evolving Hockey <span class="citation" data-cites="evolvinghockey2021xgmodel"><a href="#ref-evolvinghockey2021xgmodel" role="doc-biblioref">[5]</a></span>. The variable importances in <a href="#fig-xG-variable-importance" class="quarto-xref">Figure&nbsp;1</a> show how each shot is measured for its contribution of the expected goals score.</p>
<div id="fig-xG-variable-importance" class="quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-xG-variable-importance-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="xG-variable-importance.png" class="img-fluid figure-img" style="width:69.0%">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-xG-variable-importance-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;1: Evolving Hockey Expected Goals Model, Variable Importance
</figcaption>
</figure>
</div>
</section>
<section id="goals-saved-above-expected" class="level2">
<h2 class="anchored" data-anchor-id="goals-saved-above-expected">Goals Saved Above Expected</h2>
<p><strong>Goals Saved Above Expected</strong> can be interpreted as the goalie version of expected goals. This is calculated as the expected goals against minus the actual number of goals the goalie has let in. A positive number means the goalie is stopping more goals than an average goalie would <span class="citation" data-cites="moneypuck_glossary"><a href="#ref-moneypuck_glossary" role="doc-biblioref">[6]</a></span>.</p>
</section>
<section id="wins-above-replacement" class="level2">
<h2 class="anchored" data-anchor-id="wins-above-replacement">Wins Above Replacement</h2>
<p><strong>Wins Above Replacement</strong> (WAR) is another metric with multiple modelling approaches. WAR attempts to assign a total value to each player to represent how much that player contributed to their team <span class="citation" data-cites="evolvinghockey_gar"><a href="#ref-evolvinghockey_gar" role="doc-biblioref">[7]</a></span>.</p>
</section>
</section>
<section id="applications-of-advanced-analytics" class="level1">
<h1>Applications of Advanced Analytics</h1>
<p>Many of the advanced analytics metrics described above are used for player evaluation. Individual metrics, such as Corsi, Fenwick, and WAR, can be used to evaluate a player’s value to a team. This can be useful in team management decisions, such as scouting, deciding which players to roster, and contract negotiations.</p>
<p>Analytics can also be used in team strategy decisions. Metrics such as expected goals can be used to determine line combinations for different scenarios. An example of analytics affecting a team’s strategy is that teams are pulling their goalie an average of 24 seconds earlier in 2021 compared to the 2013-14 season. Seattle Kraken head coach Dave Hakstol credits this change to a heavier reliance on analytics <span class="citation" data-cites="seattletimes2022pullinggoalies"><a href="#ref-seattletimes2022pullinggoalies" role="doc-biblioref">[8]</a></span>.</p>
<p>There are also fan implications. Advanced analytics metrics are consistently being discussed during broadcasts, enhancing fan engagement and understanding of the sport. Moneypuck’s “Deserve To Win O’Meter” <a href="#fig-deservo-meter" class="quarto-xref">Figure&nbsp;2</a> is a fun graphical way to show which team “deserved” to win the game, regardless of the actual score based on expected goals. It’s interesting that teams that finish the game at above 50% on the meter have historically won 64% of games <span class="citation" data-cites="moneypuck_about"><a href="#ref-moneypuck_about" role="doc-biblioref">[9]</a></span>.</p>
<div id="fig-deservo-meter" class="quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-deservo-meter-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="deservo-meter.png" class="img-fluid figure-img" style="width:69.0%">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-deservo-meter-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;2: Moneypuck “Deserve To Win O’Meter” for a game between Philadelphia Flyers and New Jersey Devils
</figcaption>
</figure>
</div>
</section>
<section id="results-and-limitations" class="level1">
<h1>Results and Limitations</h1>
<p>Due to the high degree of randomness in sports, specifically in hockey, there are some concerns and limitations about the effectiveness of advanced analytics. For example, moneypuck’s game prediction model states that “For the 2023-2024 regular season, the team the pre-game model had as the favorite won 61.1% of games. The model’s log loss was 0.661” <span class="citation" data-cites="moneypuck_about"><a href="#ref-moneypuck_about" role="doc-biblioref">[9]</a></span>. While better than picking randomly, an accuracy score of 61% does not induce confidence in any given prediction. One example of public opinion turning against sports analytics is when the Tampa Bay Rays (MLB) pulled their pitcher while he was in the midst of a no-hitter. This was an analytics-based decision, and was largely criticized <span class="citation" data-cites="mlb2020snell"><a href="#ref-mlb2020snell" role="doc-biblioref">[10]</a></span>.</p>
<p>Another limitation is the public availability of high quality data. NHL team in-house data is often tightly guarded and not shared with the public. This is evidenced by Winnipeg Jets head coach Paul Maurice criticizing public analytical models, stating that the public analytics did not match the Jets in-house models <span class="citation" data-cites="topdownhockey2022maurice"><a href="#ref-topdownhockey2022maurice" role="doc-biblioref">[11]</a></span>.</p>
</section>
<section id="technologies" class="level1">
<h1>Technologies</h1>
<p>If you are interested in working in hockey analytics, it’s important to be skilled in programming/software, data analysis and statistical techniques, and presentation. Hockey specific domain knowledge can also be a valuable asset.</p>
<p>Most analytical tools are built with programming languages <strong>Python</strong>, <strong>R</strong>, and <strong>SQL</strong>. It is also important to understand key Python libraries, such as <strong>Pandas</strong> (data manipulation), <strong>NumPy</strong> (numerical computation), <strong>Matplotlib/Seaborn/Altair</strong> (data visualization), and <strong>scikit-learn</strong> (machine learning).</p>
<p>It is also important to have a solid understanding of data analysis and statistical techniques. Statistical concepts including distributions, regression analysis, hypothesis testing, and correlation are crucial for analyzing player performance and game data. Machine learning techniques, such as decision trees, random forests, and neural networks are very useful for predictive modelling.</p>
<p>A critical but underestimated skill is data visualization and storytelling. The usefulness of the most complex analysis can be very limited if it is not translated into insights that are accessible and understandable for non-technical audiences, which include the main consumers of hockey analytics data (coaches, broadcasters, fans).</p>
</section>
<section id="resources" class="level1">
<h1>Resources</h1>
<p>Hockey analytics is continuously innovating and growing. Some analytical tools are publicly available:</p>
<ul>
<li>https://www.naturalstattrick.com</li>
<li>https://www.moneypuck.com</li>
<li>https://evolving-hockey.com/</li>
<li>https://hockeyviz.com</li>
<li>https://hockeyprospecting.com</li>
<li>https://eprinkside.com</li>
<li>https://www.allthreezones.com</li>
<li>https://public.tableau.com/app/profile/topdownhockey/vizzes</li>
<li>Twitter community (@jfresh, @domluszczyszyn, etc.)</li>
</ul>
<p>There are also many useful sources of raw data, including:</p>
<ul>
<li>https://moneypuck.com/data.htm</li>
<li>https://www.nhl.com/stats/</li>
<li>https://edge.nhl.com/en/home</li>
<li>https://www.hockey-reference.com/</li>
</ul>
</section>
<section id="summary-and-final-thoughts" class="level1">
<h1>Summary and Final Thoughts</h1>
<ul>
<li>Hockey analytics is the process of analyzing hockey players and teams through the use of statistics, machine learning, and other tools, to gain a greater understanding of the effects of their performance.</li>
<li>Key metrics include Corsi, Fenwick, PDO, Expected Goals, Goals Saved Above Expected, and Wins Above Replacement.</li>
<li>Advanced analytics can be applied in player evaluation, team strategy, and fan engagement.</li>
<li>Concerns and limitations about the use of analytics in hockey include lack of model accuracy and lack of high quality data.</li>
<li>Important technological skills in hockey analytics include programming/software skills, data analysis and statistical techniques, domain specific knowledge, and presentation skills.</li>
</ul>
</section>
<section id="references" class="level1">




</section>

<div id="quarto-appendix" class="default"><section class="quarto-appendix-contents" role="doc-bibliography" id="quarto-bibliography"><h2 class="anchored quarto-appendix-heading">References</h2><div id="refs" class="references csl-bib-body" data-entry-spacing="0" role="list">
<div id="ref-wilson2014corsi" class="csl-entry" role="listitem">
<div class="csl-left-margin">[1] </div><div class="csl-right-inline">M. Wilson, <span>“Wilson: Don’t know corsi? Here’s a handy-dandy primer on advanced stats,”</span> <em>Calgary Herald</em>, 2014, Available: <a href="https://web.archive.org/web/20150212084832/http://www.calgaryherald.com/sports/Wilson+know+Corsi+Here+handy+dandy+primer+advanced+stats/10265096/story.html">https://web.archive.org/web/20150212084832/http://www.calgaryherald.com/sports/Wilson+know+Corsi+Here+handy+dandy+primer+advanced+stats/10265096/story.html</a></div>
</div>
<div id="ref-liu2023pdo" class="csl-entry" role="listitem">
<div class="csl-left-margin">[2] </div><div class="csl-right-inline">M. Liu, <span>“Explaining PDO and why it matters in hockey,”</span> <em>CanucksArmy</em>, 2023, Available: <a href="https://canucksarmy.com/news/pdo-stats-hockey-vancouver-canucks-kuzmenko">https://canucksarmy.com/news/pdo-stats-hockey-vancouver-canucks-kuzmenko</a></div>
</div>
<div id="ref-oconnor2019playdriving" class="csl-entry" role="listitem">
<div class="csl-left-margin">[3] </div><div class="csl-right-inline">C. O’Connor, <span>“Hockey advanced stats primer, part 2: How can (and should) we measure play-driving ability?”</span> <em>The Athletic</em>, 2019, Available: <a href="https://www.nytimes.com/athletic/1381978/2019/12/05/hockey-advanced-stats-primer-part-2-how-can-and-should-we-measure-play-driving-ability/">https://www.nytimes.com/athletic/1381978/2019/12/05/hockey-advanced-stats-primer-part-2-how-can-and-should-we-measure-play-driving-ability/</a></div>
</div>
<div id="ref-hockeystatistics2022xgmodel" class="csl-entry" role="listitem">
<div class="csl-left-margin">[4] </div><div class="csl-right-inline">H. Statistics, <span>“Building an xG model v1.0,”</span> <em>Hockey Statistics</em>, 2022, Available: <a href="https://hockey-statistics.com/2022/08/14/building-an-xg-model-v-1-0/">https://hockey-statistics.com/2022/08/14/building-an-xg-model-v-1-0/</a></div>
</div>
<div id="ref-evolvinghockey2021xgmodel" class="csl-entry" role="listitem">
<div class="csl-left-margin">[5] </div><div class="csl-right-inline">E. Hockey, <span>“A new expected goals model for predicting goals in the NHL,”</span> <em>Evolving Hockey Blog</em>, 2021, Available: <a href="https://evolving-hockey.com/blog/a-new-expected-goals-model-for-predicting-goals-in-the-nhl/">https://evolving-hockey.com/blog/a-new-expected-goals-model-for-predicting-goals-in-the-nhl/</a></div>
</div>
<div id="ref-moneypuck_glossary" class="csl-entry" role="listitem">
<div class="csl-left-margin">[6] </div><div class="csl-right-inline">MoneyPuck, <span>“Glossary of terms.”</span> n.d. Available: <a href="https://moneypuck.com/glossary.htm">https://moneypuck.com/glossary.htm</a></div>
</div>
<div id="ref-evolvinghockey_gar" class="csl-entry" role="listitem">
<div class="csl-left-margin">[7] </div><div class="csl-right-inline">E. Hockey, <span>“Goals above replacement (GAR).”</span> n.d. Available: <a href="https://evolving-hockey.com/glossary/goals-above-replacement/">https://evolving-hockey.com/glossary/goals-above-replacement/</a></div>
</div>
<div id="ref-seattletimes2022pullinggoalies" class="csl-entry" role="listitem">
<div class="csl-left-margin">[8] </div><div class="csl-right-inline">G. Baker, <span>“Here’s why the kraken and other NHL teams are pulling goalies earlier,”</span> <em>The Seattle Times</em>, 2022, Available: <a href="https://www.seattletimes.com/sports/kraken/heres-why-the-kraken-and-other-nhl-teams-are-pulling-goalies-earlier/">https://www.seattletimes.com/sports/kraken/heres-why-the-kraken-and-other-nhl-teams-are-pulling-goalies-earlier/</a></div>
</div>
<div id="ref-moneypuck_about" class="csl-entry" role="listitem">
<div class="csl-left-margin">[9] </div><div class="csl-right-inline">MoneyPuck, <span>“About MoneyPuck.”</span> n.d. Available: <a href="https://moneypuck.com/about.htm">https://moneypuck.com/about.htm</a></div>
</div>
<div id="ref-mlb2020snell" class="csl-entry" role="listitem">
<div class="csl-left-margin">[10] </div><div class="csl-right-inline">MLB.com, <span>“Debate over blake snell’s 2020 world series game 6 decision,”</span> <em>MLB.com</em>, 2020, Available: <a href="https://www.mlb.com/news/debate-blake-snell-2020-world-series-game-6">https://www.mlb.com/news/debate-blake-snell-2020-world-series-game-6</a></div>
</div>
<div id="ref-topdownhockey2022maurice" class="csl-entry" role="listitem">
<div class="csl-left-margin">[11] </div><div class="csl-right-inline">T. D. Hockey, <span>“What to make of paul maurice’s crusade against public hockey analytics,”</span> <em>Medium</em>, 2022, Available: <a href="https://topdownhockey.medium.com/what-to-make-of-paul-maurices-crusade-against-public-hockey-analytics-32f3cea90c1d">https://topdownhockey.medium.com/what-to-make-of-paul-maurices-crusade-against-public-hockey-analytics-32f3cea90c1d</a></div>
</div>
</div></section></div></main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const onCopySuccess = function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  }
  const getTextToCopy = function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
    text: getTextToCopy
  });
  clipboard.on('success', onCopySuccess);
  if (window.document.getElementById('quarto-embedded-source-code-modal')) {
    // For code content inside modals, clipBoardJS needs to be initialized with a container option
    // TODO: Check when it could be a function (https://github.com/zenorocha/clipboard.js/issues/860)
    const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
      text: getTextToCopy,
      container: window.document.getElementById('quarto-embedded-source-code-modal')
    });
    clipboardModal.on('success', onCopySuccess);
  }
    var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
    var mailtoRegex = new RegExp(/^mailto:/);
      var filterRegex = new RegExp('/' + window.location.host + '/');
    var isInternal = (href) => {
        return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
    }
    // Inspect non-navigation links and adorn them if external
 	var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
    for (var i=0; i<links.length; i++) {
      const link = links[i];
      if (!isInternal(link.href)) {
        // undo the damage that might have been done by quarto-nav.js in the case of
        // links that we want to consider external
        if (link.dataset.originalHref !== undefined) {
          link.href = link.dataset.originalHref;
        }
      }
    }
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      if (note) {
        return note.innerHTML;
      } else {
        return "";
      }
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      // TODO in 1.5, we should make sure this works without a callout special case
      if (note.classList.contains("callout")) {
        return note.outerHTML;
      } else {
        return note.innerHTML;
      }
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->




</body></html>